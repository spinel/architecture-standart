# Архитектурное решение для синхронизации ставок по депозитам

## Название задачи
Разработка архитектуры синхронизации ставок по депозитам между системами банка и кол-центрами

## Автор
Команда цифровой трансформации банка "Стандарт"

## Дата
2025-06-10

## Функциональные требования

### Use Cases

| № | Действующие лица или системы | Use Case | Описание |
|:-:|:-|:-|:-|
| 1 | АБС, База данных ставок | Обновление ставок по депозитам | 1. Менеджер бэк-офиса обновляет ставки в АБС<br>2. АБС синхронизирует ставки с базой данных ставок<br>3. Система формирует файл с актуальными ставками |
| 2 | Система кол-центра, База данных ставок | Получение актуальных ставок | 1. Система кол-центра запрашивает актуальные ставки<br>2. База данных ставок предоставляет данные<br>3. Система кол-центра обновляет локальную копию ставок |
| 3 | Партнёрский кол-центр, SFTP-сервер | Получение файла со ставками | 1. SFTP-сервер получает файл со ставками<br>2. Партнёрский кол-центр загружает файл<br>3. Система партнёрского кол-центра обновляет локальную копию ставок |
| 4 | Менеджер кол-центра, Система кол-центра | Консультация по ставкам | 1. Менеджер получает запрос от клиента<br>2. Система кол-центра показывает актуальные ставки<br>3. Менеджер консультирует клиента |

## Нефункциональные требования

| № | Требование |
|:-:|:-|
| 1 | Время синхронизации ставок между системами не должно превышать 5 минут |
| 2 | Система должна обеспечивать целостность данных при синхронизации |
| 3 | Необходимо обеспечить безопасную передачу файлов со ставками |
| 4 | Система должна поддерживать версионирование ставок |
| 5 | Необходимо обеспечить аудит изменений ставок |
| 6 | Система должна быть устойчива к сбоям при передаче данных |

## Решение

### Контекстная диаграмма
[rates-context-diagram.png]

Основные компоненты системы:
1. АБС
2. База данных ставок
3. Система кол-центра
4. SFTP-сервер
5. Партнёрский кол-центр

### Диаграмма контейнеров
[rates-container-diagram.png]

Детализация компонентов:

#### АБС
- Сервис управления ставками
- Сервис синхронизации
- База данных (Oracle)

#### База данных ставок
- API для доступа к ставкам
- Сервис формирования файлов
- База данных (MS SQL)

#### Система кол-центра
- Сервис синхронизации ставок
- Локальная база данных ставок
- API для доступа к ставкам

#### SFTP-сервер
- Сервис передачи файлов
- Хранилище файлов

### Логика принятия решений

1. **Выбор технологий**
   - Использование MS SQL для централизованного хранения ставок
   - Реализация SFTP-сервера для передачи файлов
   - Использование существующих баз данных в системах

2. **Архитектурные решения**
   - Внедрение централизованной базы данных ставок
   - Реализация механизма синхронизации через файлы
   - Создание API для доступа к ставкам

3. **Интеграционные решения**
   - Использование SFTP для передачи файлов
   - Реализация REST API для внутренних систем
   - Внедрение механизма версионирования ставок

## Альтернативы

### Альтернатива 1: Прямая интеграция через API
**Преимущества:**
- Мгновенная синхронизация данных
- Меньше промежуточных компонентов
- Проще отслеживать изменения

**Недостатки:**
- Не подходит для партнёрского кол-центра
- Требует изменений в существующих системах
- Сложнее обеспечить безопасность

### Альтернатива 2: Использование очередей сообщений
**Преимущества:**
- Асинхронная обработка изменений
- Высокая надежность доставки
- Масштабируемость

**Недостатки:**
- Сложность реализации
- Не подходит для партнёрского кол-центра
- Требует дополнительной инфраструктуры

## Недостатки, ограничения, риски

### Недостатки
1. Задержка в синхронизации данных через файлы
2. Необходимость поддержки нескольких форматов данных
3. Сложность отслеживания изменений в файлах
4. Дополнительная нагрузка на системы при синхронизации

### Ограничения
1. Невозможность прямой интеграции с партнёрским кол-центром
2. Ограничения в формате передаваемых данных
3. Зависимость от доступности SFTP-сервера
4. Ограничения в частоте обновления данных

### Риски
1. Потеря данных при передаче файлов
2. Несогласованность данных между системами
3. Перегрузка систем при частом обновлении ставок
4. Риски безопасности при передаче файлов 